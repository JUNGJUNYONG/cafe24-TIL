대규모 데이터란 무엇인가?에 대한 감을 잡아야 함



## 강의 4, 하테나 북마크의 데이터 규모

#### 데이터가 많을수록 처리에 시간이 걸린다.

---

#### [ 하테나 북마크를 예로 본 대규모 데이터 ]

>  ```mysql
> select count(*) from relword;
> > 351277311
>  ```
>
> 어느 엔트리의 어떤 키워드가 포함되어 있는지를 나타내는 DB 테이블의 건수 : 3억 5천만!

#### [하테나 북마크의 데이터 규모]

> | 레코드 수                        | 데이터크기                         |
> | -------------------------------- | :--------------------------------- |
> | entry 테이블 : 1,520만 엔트리    | 엔트리 : 3GB                       |
> | bookmark 테이블 : 4,500만 북마크 | 북마크 : 5.5GB                     |
> | tag 테이블 : 5,000만 태그        | 태그 : 4.8GB<br/>HTML : 200GB 이상 |
>
> 하테나 북마크의 데이터 규모
>
> > relword라는 테이블은 대략 10GB

<https://jojoldu.tistory.com/243>  : index 참조

<http://blog.naver.com/PostView.nhn?blogId=devfarm&logNo=221414161481&parentCategoryNo=&categoryNo=22&viewDate=&isShowPopularPosts=true&from=search> : 메모리 vs 디스크 차이





[Chapter 2] 대규모 데이터 처리 입문

● 먼저 데이터 크기에 관한 직관적인 감각을 가지고 있어야 한다.

천만 단위의 레코드를 가진 테이블의 용량은 GB 단위의 데이터 크기를 가진다.

ex. 2009년 하테나 북마크의 데이터 규모

 entry 테이블의 1520만 엔트리 -> 3GB

 

위와 같은 규모는 중~대규모 정도로 보며 Google이나 Yahoo! 정도를 초대규모로 보면 된다.

 

● 메모리와 디스크

메모리와 디스크의 데이터 access 의 속도차이는 확연히 차이가 난다. 디스크(HDD)는 물리적으로 탐색을 하기 때문에 오래 걸릴 수 밖에 없다. 이 둘의 속도차는 거의 10^5 ~ 10^6 정도 차이가 보이며 이는 10만배~100만배에 해당된다.

탐색 뿐만 아니라 버스의 전송 속도에도 약 100배 정도의 속도차를 보인다.

버스 전송 속도 차이

- 메모리: 7.5GB/sec

- 디스크: 58MB/sec

(참고로, SSD는 전기적 신호로 탐색을 하기 때문에 탐색보다는 버스 전송 속도 차이에서 크게 발생한다.)

 

● 병목 원인 파악

병목 원인을 파악하기 위해서는 추측하지 말고 계측을 통해 판단해야 한다. 

 

병목의 원인으로 크게 두 가지 경우로 나눌 수 있다.

- CPU 부하(주로 AP서버에서 발생)

- I/O 부하(주로 DB서버에서 발생)

 

1) CPU 부하

원인 파악)

- 사용자 프로그램이 문제인지 시스템 프로그램이 문제인지 확인한다.(명령어 ps, top, sar 으로 확인)

- 원인이 되는 프로세스 파악 후 더욱 상세히 조사 한다.(strace로 추적 및 oprofile 프로파일링)

 

해결 방안)

- 서버 증설(매우 쉬움), 로직 수정, 알고리즘 개선, 오류 제거 등 작업을 수행한다.

- 서버를 증설하는 스케일 아웃한 방식은 웹 서버에 있어서 좋은 방식이다. 

 

2) I/O 부하

원인 파악

- 프로그램 입출력이 많은 경우

- 스왑이 발생하여 디스크 액세스가 발생하는 경우

 -> 특정 프로세스가 극단적으로 사용하고 있나?

 -> 프로그램 오류로 인한 지나치게 메모리를 사용하고 있는건 아닌지?

 -> 단순한 용량 부족인지?

 

해결 방안

- 프로그래밍의 입출력을 줄일 수 있으면 가장 좋다.(알고리즘 수정 등..)

참고로 하테나 서버의 상황(2005년 기준)은 AP 서버 10대 DB 서버 25대를 운용하고 있다.

AP서버는 늘리면 그만이지만, DB 서버는 I/O 부하의 규모조정이 어렵기 때문에 무조껀 늘리는 것은 답이 아니다.

 

● 용어 정리

튜닝이란?

- 본래의 성능을 낼 수 있도록 최적화하는 것

 

● 궁금한점

1. 크롤러(Crawler)?

2. 프록시 서버는 무엇이며 어떤 역할을 할까?

3. strace로 추적 및 oprofile 프로파일링

4. I/O 과 스왑 간 어떤 관계가 있는가?

 

● 참고 서적

제이펍 출판사, 대규모 서비스를 지탱하는 기술, '이토 나오야, 다나카 신지' 저, 2011년 02월 28일 발행







































